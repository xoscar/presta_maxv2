// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  username String  @unique
  password String
  token    String?
  name     String?
  role     String  @default("user")

  clients Client[]
  loans   Loan[]
  charges Charge[]

  @@map("users")
}

model Client {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  clientId  String   @map("client_id")
  name      String
  surname   String
  address   String
  phone     String
  search    String[]
  createdAt DateTime @default(now()) @map("created")
  updatedAt DateTime @updatedAt @map("updated")

  userId String @map("user_id") @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  loans   Loan[]
  charges Charge[]

  @@index([userId, createdAt(sort: Desc)])
  @@map("clients")
}

model Loan {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  numberId         Int       @map("number_id")
  amount           Float
  weeklyPayment    Float     @map("weekly_payment")
  weeks            Int
  description      String?
  clientName       String?   @map("client_name")
  clientIdentifier String?   @map("client_identifier")
  finished         Boolean   @default(false)
  finishedDate     DateTime? @map("finished_date")
  visible          Boolean   @default(true)
  expiredDate      DateTime  @map("expired_date")
  search           String[]
  createdAt        DateTime  @default(now()) @map("created")
  updatedAt        DateTime  @updatedAt @map("updated")

  payments Payment[]

  clientId String? @map("client_id") @db.ObjectId
  client   Client? @relation(fields: [clientId], references: [id])

  userId String @map("user_id") @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  @@index([userId, createdAt(sort: Desc)])
  @@map("loans")
}

model Payment {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  amount    Float
  createdAt DateTime @default(now()) @map("created")

  loanId String @map("loan_id") @db.ObjectId
  loan   Loan   @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Charge {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  amount         Float
  description    String?
  paid           Boolean   @default(false)
  paidDate       DateTime? @map("paid_date")
  expirationDate DateTime? @map("expiration_date")
  createdAt      DateTime  @default(now()) @map("created")

  clientId String @map("client_id") @db.ObjectId
  client   Client @relation(fields: [clientId], references: [id])

  userId String @map("user_id") @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  @@index([clientId])
  @@map("charges")
}

model Counter {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  name  String @unique
  count Int    @default(1)

  @@map("counters")
}
